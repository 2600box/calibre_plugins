## Release History

**Version 1.8.0** - XX Sep 2022
- New: All kiwidude plugins updated/migrated to: https://github.com/kiwidude68/calibre_plugins
- Update: Drop PyQt4 support, require calibre 2.85.1 or later.
- Update: Refactoring of common code

**Version 1.7.3** - 25 Apr 2022 by chaley
- Fix: Remove some python 3 code inadvertently left in after debugging.

**Version 1.7.2** - 23 Apr 2022 by chaley
- Fix: "Remove broken TOC entries in NCX file" on Linux. Improvement of error message when no epubs were changed.

**Version 1.7.0** - 19 Jan 2022 by chaley
- Update: Support for calibre 6

**Version 1.6.3** - 27 Jul 2021 by chaley
- Fix: More 'fix exception in rare cases when replacing the cover'.

**Version 1.6.2** - 18 Dec 2020 by chaley
- Fix: Exception in rare cases when replacing the cover

**Version 1.6.1** - 5 Oct 2020 by chaley
- Fix: Crash caused by presence of DRM

**Version 1.6.0** - 30 Sep 2020 by chaley
- Update: Make plugin compatible with calibre 5 (Python 3)

**Version 1.4.0** - 17 Oct 2019
- New: Added option to only remove pagemaps and related artifacts generated by Google Play, leaving pagemaps from other sources intact. (Note that removing all pagemaps will override this option.)
- New: Incorporated Terisa de morgan's option to move metadata jackets to the end of the book.
- Update: Minor adjustments to the "unpretty" option, including consideration of EPUB3 elements (section/nav) and removal of EMPTY "display: none" elements.
- Update: Incorporated JimmXinu's fix to the list-based file removal logic.
- Fix: Expanded .xpgt link removal for better detection.
- Fix: Resequenced modules so that deep parsing would not undo "unpretty" function's work.
- Fix: Enhanced pagemap removal function to work regardless of the filename.
- Note: Neither pagemap removal routine affects pagelists incorporated into NCX files.

**Version 1.3.14** - 29 Nov 2017
- New: Added option to remove page-map.xml files.

**Version 1.3.13** - 05 Jul 2015
- New: Added option to disable the confirmation prompt each time to update the epub. Use at your own risk - if you make simultaneous other changes to the book record they may get lost.
- Fix: Cancel on the progress dialog

**Version 1.3.12** - 02 Oct 2014
- Update: Enhancement to "stripkobo", "stripspans", and "unpretty" options: All three now remove &lt;/br&gt; and &lt;/hr&gt; tags and always make BR and HR self-closing elements. (This fixes invalid &lt;br&gt; and &lt;hr&gt; markup, if such is present.)
- Update: Moved "stripkobo", "stripspans", and "unpretty" into the "Known artifacts" category to balance the dialog box better.
- Update: Added some code to dialogs.py to make the dialog box scrollable on smaller screens.
- Update: Help file filled in how one can detect the need to smarten punctuation (was previously blank.)
- Fix: Minor bug in "stripkobo" option that missed some Kobo artifacts inside the HEAD element.
- Fix: Minor spacing bugs in "unpretty" option.

**Version 1.3.11** - 13 Aug 2014
- New: Add an "unpretty" option to de-indent and otherwise reformat HTML elements in markup. This should have no effect on the rendered content; it only cleans the source code up a bit.
- New: Add a "stripspans" option to allow removal of attributeless &lt;span&gt; elements from markup, as well as normalizing empty &lt;x&gt;&lt;/x&gt; elements to the &lt;x/&gt; form.
- New: Add a "stripkobo" option to allow removal of the Kobo-specific code from kepub books, transforming them into standard EPUB books. This does NOT remove Kobo's DRM.
- Note: Both of the above will also completely remove A, B, I, U, BIG, SMALL, EM, SPAN, and STRONG elements from the markup when those elements have neither attributes nor content.
- Fix: "Remove Adobe resource DRM meta tags" option to remove leading spaces and/or newlines, so these meta tags are completely removed instead of leaving blank lines.

**Version 1.3.10** - 28 Jul 2014
- Update: For Calibre 2.0 compliance.

**Version 1.3.9** - 01 Sep 2013
- Fix: Users who do not have any Extra CSS in their defaults trying to use the Append Extra CSS option.

**Version 1.3.8** - 30 Aug 2013
- New: Add a "Append extra CSS" option to allow appending any css style information from Preferences->Common Options->Look & Feel->Extra CSS to each .css file in the ePub.
- Update: Respect the tweak "save_original_format_when_polishing" if set to make a .ORIGINAL_EPUB copy of the book before making modifications if no such copy exists.
- Update: After running Modify ePub ensure the book details panel is updated in case an ORIGINAL_EPUB was added
- Fix: Encrypted font ePubs being treated as DRM protected preventing Font removal

**Version 1.3.7** - 15 Feb 2013
- Fix: Dependency on calibre code removed in 0.9.19

**Version 1.3.6** - 09 Dec 2012
- Fix: For "Rewrite CSS margins" to ensure it only processes manifest xhtml files when replacing inline styles.

**Version 1.3.5** - 22 Nov 2012
- New: Add a separate `me.py` script to allow Modify ePub to be run from the command line. Unzip it and refer to the script for help on how to use it.
- Update: Change to ensure when running via command line the lack of an opf file allows plugin to still run.

**Version 1.3.4** - 16 Nov 2012
- Fix: For calibre "bug" to ensure that if user has both remove javascript and smarten punctuation checked, that remove javascript runs first which ensures smarten punctuation will actually work correctly for quotes.

**Version 1.3.3** - 08 Nov 2012
- Fix: For when Update metadata is "not" selected

**Version 1.3.2** - 08 Nov 2012
- Fix: Regression from last release where only selecting the "Update metadata" option would not apply changes.

**Version 1.3.1** - 06 Nov 2012
- Update: Ensure than the "Remove non dc: metadata" option will always run after "Update metadata" if both are selected.
- Update: Reorganise some of the layout and groups.

**Version 1.3.0** - 04 Nov 2012
- New: Add a "Encode HTML in UTF-8" option strip charset meta tags and re-encode in UTF-8 for books that do not display correctly in calibre viewer
- Update: Change the UI appearance to look more balanced.

**Version 1.2.10** - 31 Aug 2012
- Update: Rewrite the playOrder to make sure it is an incremental sequence after actions that delete from the TOC.
- Update: Change indenting from mucking up self-closing tags in NCX.

**Version 1.2.9** - 04 Jul 2012
- Update: Alter the "Proceed" message text to hopefully make it clearer to new users.
- Update: Change "Rewrite CSS margins" so that if default margins are zero it writes out margin attributes with a value of zero, rather than removing them
- Update: Change "Rewrite CSS margins" so that if default margins are negative then it omits the margin attribute from the style
- Update: Enhance "Rewrite CSS margins" so that if CSS file has no content it is deleted from the epub
- Update: Rename "Rewrite CSS margins" to "Modify @page and body style margins"
- Fix "Rewrite CSS margins" bug where if default margins are set to zero and an epub has margins specified it would error
- Fix "Rewrite CSS margins" bug where if default margins are set to zero it should not add an empty @page directive
- Fix: "Remove unused images" not detecting svg images in an svg section containing sibling tags
- Fix: "Remove Adobe xpgt links" so that it includes removal of links using the @import format.

**Version 1.2.7** - 29 Jun 2012
- Update: When inserting covers, if guide points to a non-existent cover href, make sure the log does not error.
- Update: In the CSS margin updating, if adding page declaration at it to start rather than end of CSS file to workaround Sigil bug

**Version 1.2.6** - 24 Jun 2012
- New: Add buttons to save and restore the current settings, to allow setting your own easily switched to defaults

**Version 1.2.5** - 15 Jun 2012
- Fix: When using the Add/replace jacket and Insert/replace cover options together if book has no jacket currently

**Version 1.2.4** - 05 Jun 2012
- New: Add some non-standard guide types of "coverimagestandard" and "thumbimagestandard" to increase cover replacement coverage
- Update: If the guide has incorrect casing of an image href, auto-correct it

**Version 1.2.3** - 05 Jun 2012
- Update: Further optimise the CSS margins feature to minimise which files get changed

**Version 1.2.2** - 05 Jun 2012
- New: Add a "Remove inline javascript and files" option to remove any javascript leftover from html conversions
- Fix for CSS margins feature which was not always updating the css file in the epub after resetting margins

**Version 1.2.1** - 01 Jun 2012
- Fix for remove Adobe xpgt links so it no longer is dependent on link attribute ordering to find them

**Version 1.2.0** - 01 Jun 2012
- New: Add a "Insert or replace cover" option to attempt to insert or replace a cover without doing a conversion
- New: Add a "Remove cover" option to attempt to completely remove an identified cover from the ePub.
- New: Add protection for numerous options against trying to apply them to a DRM encrypted book
- Update: Change to require minimum calibre version 0.8.53 in order to utilise some calibre bug fixes/changes
- Update: Change to calibre API for deprecated dialog in 0.8.49 which caused issues that intermittently crashed calibre on Mac OS
- Update: Rewrite "Removed unused image files" and "Remove broken cover images" features to use lxml rather than regex for better accuracy
- Update: Better handle ebooks where the ncx file is not in same directory as opf manifest
- Fix: If user chooses redundant options (e.g. "Remove all jackets" makes "Remove legacy jackets" redundant) do not run the redundant option

**Version 1.1.7** - 17 May 2012
- Fix: Re-release of 1.1.6 to cater for missing file

**Version 1.1.6** - 17 May 2012
- New: Add a "Remove broken cover images" option to remove html pages which contain only an image tag to a broken image.
- New: Add a "Remove broken TOC entries in NCX" option to remove ncx entries that point to non-existent html pages
- Fix: The last_modified column not being updated if multiple books modified
- Fix: Remove unused images to include svg and bmp files as possible image extensions

**Version 1.1.5** - 09 May 2012
- Update: When performing any Modify action, update the last_modified column in calibre for the book.
- Fix: Remove xpgt files and links to remove the xpgt file from the manifest

**Version 1.1.4** - 07 May 2012
- Update: When using the Remove xpgt files and links option, remove trailing whitespace after the removed &lt;link&gt;
- Fix: When no epubs are modified, ensure the log detail is available to review
- Fix: Remove unused images to check encrypted and unencrypted names, skip DRM ebooks

**Version 1.1.3** - 07 May 2012
- Fix: Remove unused images to better handle image paths with other characters like commas

**Version 1.1.2** - 07 May 2012
- Fix: Remove unused images to better handle image paths with spaces

**Version 1.1.1** - 05 May 2012
- Fix: Remove unused images to url encode image paths with spaces in them, and handle namespaced images

**Version 1.1.0** - 05 May 2012
- New: Add a "Remove Adobe .xpgt files and links" option for complete clean xpgt file removal
- New: Add a "Remove Adobe resource DRM meta tags" option for stripping DRM &lt;meta&gt; resource identifiers from xhtml content.
- New: Add a "Remove unused image files" option to remove orphaned images not referenced from the html content to save space.
- New: Add a "Flatten TOC hierarchy in NCX file" option to move all the navPoints to a single level if they are nested.
- Update: Extend "Remove embedded fonts" to also remove @font-face declarations from the CSS and html files
- Update: Move the "Remove margins from Adobe .xpgt files" into a new Adobe section on the UI

**Version 1.0.2** - 12 Feb 2012
- New: Add ability to smarten punctuation of HTML files

**Version 1.0.1** - 23 Nov 2011
- Update: When updating metadata, ensure that if calibre has no tags any dc:subject elements are removed
- Update: Improve the logging output when removing non dc: metadata elements

**Version 1.0.0** - 22 Oct 2011
- Update: Preparation for deprecation for db.format_abspath() function in future Calibre for network backends
- Update: Merge in remaining CSS/margin changes from Idolse for initial release
- Update: Support keyboard shortcut for opening dialog

**Version 0.3.5** - 26 Jun 2011
- Fix: Issue with css margin rewriting that used property names using '_' instead of '-'

**Version 0.3.4** - 21 Jun 2011
- Update: Remove dependency on the Calibre epub-fix Container class to allow plugin to develop independently
- Update: Incorporate ldolse's rewrite CSS margin code to reset page/body margins
- Fix: Issue with some NCX files not parsing correctly causing error with OS artifact removal

**Version 0.3.1** - 12 Jun 2011
- Update: No longer look in manifest for NCX file, look for physical file instead to get around media-type variant issues
- Update: Additional mime type for xpgt files as supplied by Idolse
- Fix: If cancel updating the ePubs, remove the temp directory

**Version 0.3** - 06 Jun 2011
- New: Add ability to remove embedded fonts
- New: Add ability to update the metadata (including cover)
- New: Add an error dialog if the user clicks ok with no options selected
- Update: Ensure rebuilding the ePub uses the Calibre zip code as per change to Tweak ePub

**Version 0.2.2** - 03 Jun 2011
- New: Add an option to remove OS artifacts of .DS_Store and thumbs.db files
- Update: Treat iTunesArtwork the same as iTunes plist files
- Update: When adding items to manifest, if a .htm* file check for xmlns indicating mimetype of xhtml+xml
- Fix: Ensure that any xml elements inserted in the manifest are "tailed" correctly for indenting

**Version 0.2.1** - 30 May 2011
- New: Ensure Calibre bookmarks and iTunes files are removed from the manifest if present there

**Version 0.2** - 30 May 2011
- New: Add option to remove iTunesArtwork files
- New: Add option to remove non dc: metadata elements
- New: Add option to add/update calibre jackets
- Update: Rename Select none to Clear all on dialog

**Version 0.1** - 26 May 2011
- Initial release of Modify ePub plugin
